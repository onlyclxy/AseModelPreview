# DML编辑器故障排除指南

## 🔧 常见问题与解决方案

### 1. NullReferenceException 空引用异常

**问题描述**: 
程序启动时或使用菜单功能时出现错误：
- `System.NullReferenceException: 未将对象引用设置到对象的实例。`
- 常见位置：`GetTextFromRichTextBox()`, `ToggleLineNumbers()`, `ToggleSyntaxHighlight()`

**原因**: 
控件在完全初始化之前被调用，或者XAML中定义的控件名称与代码中的引用不匹配，导致空引用。

**解决方案**: 
✅ **已修复** - 在最新版本中已经添加了全面的空引用检查。
- 更新到最新版本
- 重新编译项目：运行 `compile_solution.bat`
- 如果仍有问题，请确保XAML中的控件名称正确：
  - `LineNumberMenuItem` 
  - `SyntaxHighlightMenuItem`
  - `LineNumberTextBlock`
  - `TextEditor`

### 2. 编译时文件被锁定

**问题描述**: 
编译时出现错误：`无法将"obj\Debug\DMLView.exe"复制到"bin\Debug\DMLView.exe"`

**原因**: 
程序正在运行，文件被锁定。

**解决方案**: 
1. **关闭程序**: 确保DML编辑器程序已关闭
2. **强制停止进程**: 
   ```powershell
   Stop-Process -Name "DMLView" -Force -ErrorAction SilentlyContinue
   ```
3. **重新编译**: 运行 `compile_solution.bat`

### 3. 程序无法启动

**问题描述**: 
双击程序后无反应或出现错误。

**可能原因**: 
- 缺少 .NET Framework 4.8
- 程序文件损坏
- 权限问题

**解决方案**: 
1. **检查.NET Framework**: 
   - 安装 .NET Framework 4.8
   - 下载地址：[Microsoft官网](https://dotnet.microsoft.com/download/dotnet-framework/net48)

2. **重新编译**: 
   - 运行 `compile_solution.bat`
   - 确保编译成功

3. **以管理员身份运行**: 
   - 右键程序 → "以管理员身份运行"

### 4. 语法高亮不工作

**问题描述**: 
DML文件打开后没有语法着色。

**解决方案**: 
1. **检查菜单设置**: 视图 → 语法高亮 (确保已勾选)
2. **重新应用高亮**: 
   - 修改文件内容
   - 等待500ms让自动高亮生效
3. **手动切换**: 取消勾选后重新勾选语法高亮

### 5. 行号不显示

**问题描述**: 
左侧没有显示行号。

**解决方案**: 
- 菜单：视图 → 行号 (确保已勾选)

### 6. 字体显示异常

**问题描述**: 
文字显示模糊或字体不正确。

**解决方案**: 
1. **更改字体**: 视图 → 字体 → 选择合适字体
2. **推荐字体**: 
   - Consolas (等宽，适合代码)
   - Courier New
   - 微软雅黑

### 7. 文件打开/保存失败

**问题描述**: 
无法打开或保存文件。

**可能原因**: 
- 文件被其他程序占用
- 权限不足
- 文件路径包含特殊字符

**解决方案**: 
1. **关闭占用文件的程序**
2. **以管理员身份运行编辑器**
3. **避免特殊字符**: 使用英文路径和文件名
4. **检查磁盘空间**: 确保有足够空间保存文件

### 8. 查找/替换功能异常

**问题描述**: 
查找功能无法正常工作。

**解决方案**: 
1. **确保有文本**: 文档不能为空
2. **检查搜索选项**: 
   - 区分大小写
   - 全字匹配
3. **重新输入搜索词**

### 9. 撤销/重做不可用

**问题描述**: 
撤销重做按钮灰色不可点击。

**解决方案**: 
- **撤销**: 需要先进行编辑操作
- **重做**: 需要先进行撤销操作
- **快捷键**: Ctrl+Z (撤销), Ctrl+Y (重做)

### 10. 程序响应缓慢

**问题描述**: 
编辑大文件时程序卡顿。

**原因**: 
语法高亮处理大量文本需要时间。

**解决方案**: 
1. **临时关闭语法高亮**: 视图 → 语法高亮 (取消勾选)
2. **文件大小限制**: 建议文件大小在1000行以下
3. **分割大文件**: 将大文件分割成多个小文件

## 🛠️ 高级故障排除

### 重置程序设置

如果程序行为异常，可以重置到默认状态：

1. **删除配置文件** (如果存在)
2. **重新启动程序**
3. **重新配置首选项**

### 完全重新安装

1. **删除程序文件夹**: `DMLView`
2. **重新下载源代码**
3. **重新编译**: `compile_solution.bat`

### 日志和调试

**手动调试步骤**:
1. 在Visual Studio中打开解决方案
2. 设置断点
3. 按F5启动调试
4. 重现问题

## 📞 获取帮助

### 自助资源

- **使用说明**: `使用说明.md`
- **技术文档**: `项目说明.md` 
- **README**: `README.md`

### 检查清单

在寻求帮助前，请确认：

- [ ] 已安装 .NET Framework 4.8
- [ ] 程序文件完整无损
- [ ] 有足够的磁盘空间
- [ ] 没有杀毒软件拦截
- [ ] 已尝试重新编译
- [ ] 已尝试以管理员身份运行

### 错误报告

如需报告错误，请提供：

1. **错误信息**: 完整的错误消息
2. **重现步骤**: 导致错误的操作步骤  
3. **系统信息**: Windows版本、.NET版本
4. **文件信息**: 尝试打开的文件类型和大小

---

**大多数问题都可以通过重新编译解决！** 🔄

运行 `compile_solution.bat` 通常能解决90%的问题。 